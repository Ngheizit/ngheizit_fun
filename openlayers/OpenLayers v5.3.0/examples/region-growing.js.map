{"version":3,"sources":["webpack:///./region-growing.js"],"names":["const","let"],"mappings":";;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAmC;AACE;AACqC;AAC7B;AACO;AACE;;AAEtD,SAAS,UAAU,CAAC,MAAM,EAAE,IAAI,EAAE;EAChCA,GAAK,CAAC,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;EACxBC,GAAG,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;EACtBD,GAAK,CAAC,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;EACnC,IAAI,CAAC,IAAI,EAAE;IACT,OAAO,KAAK,CAAC;GACd;;EAED,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;EAC5BA,GAAK,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;EAC1BA,GAAK,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;EAC5BA,GAAK,CAAC,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC;EAC7BA,GAAK,CAAC,UAAU,GAAG,IAAI,iBAAiB,CAAC,SAAS,CAAC,CAAC;EACpDA,GAAK,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;EAChDA,GAAK,CAAC,KAAK,GAAG,SAAS,CAAC,OAAO,CAAC,CAAC;EACjCA,GAAK,CAAC,KAAK,GAAG,SAAS,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC;EACrCA,GAAK,CAAC,KAAK,GAAG,SAAS,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC;EACrCC,GAAG,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC;EAClB,OAAO,IAAI,CAAC,MAAM,EAAE;IAClBD,GAAK,CAAC,OAAO,GAAG,EAAE,CAAC;IACnB,KAAKC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE;;;;MAI7CD,GAAK,CAAC,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;MACjC,KAAKC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE;QAC7CD,GAAK,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACrBA,GAAK,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACrB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,MAAM,EAAE;UAC/CA,GAAK,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;UAC/BA,GAAK,CAAC,EAAE,GAAG,SAAS,CAAC,EAAE,CAAC,CAAC;UACzBA,GAAK,CAAC,EAAE,GAAG,SAAS,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;UAC7BA,GAAK,CAAC,EAAE,GAAG,SAAS,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;UAC7BA,GAAK,CAAC,EAAE,GAAG,SAAS,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;;UAE7B,IAAI,EAAE,KAAK,CAAC,EAAE;YACZ,SAAS;WACV;UACD,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,GAAG,EAAE,CAAC,GAAG,KAAK,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,GAAG,EAAE,CAAC,GAAG,KAAK;cAC5D,IAAI,CAAC,GAAG,CAAC,KAAK,GAAG,EAAE,CAAC,GAAG,KAAK,EAAE;YAChC,UAAU,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;YACrB,UAAU,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;YACvB,UAAU,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;YACvB,UAAU,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;YACzB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;WACtB;;UAED,SAAS,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;SACvB;OACF;KACF;IACD,IAAI,GAAG,OAAO,CAAC;GAChB;EACD,OAAO,CAAC,IAAI,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;CACzD;;AAED,SAAS,UAAU,CAAC,IAAI,EAAE;EACxBA,GAAK,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;EAClBA,GAAK,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;EAClB,OAAO;IACL,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;IACV,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;IACV,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;IACV,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;GACX,CAAC;CACH;;AAEDA,GAAK,CAAC,GAAG,GAAG,kEAAkE,CAAC;;AAE/EA,GAAK,CAAC,OAAO,GAAG,IAAI,gEAAS,CAAC;EAC5B,MAAM,EAAE,IAAI,0EAAQ,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,UAAU,EAAE,QAAQ,CAAC,CAAC;CACvD,CAAC,CAAC;;AAEHA,GAAK,CAAC,MAAM,GAAG,IAAI,wEAAY,CAAC;EAC9B,OAAO,EAAE,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC;EAC9B,aAAa,EAAE,OAAO;EACtB,SAAS,EAAE,UAAU;;;EAGrB,GAAG,EAAE;IACH,UAAU,EAAE,UAAU;GACvB;CACF,CAAC,CAAC;;AAEHA,GAAK,CAAC,WAAW,GAAG,IAAI,gEAAU,CAAC;EACjC,OAAO,EAAE,GAAG;EACZ,MAAM,EAAE,MAAM;CACf,CAAC,CAAC;;AAEHA,GAAK,CAAC,GAAG,GAAG,IAAI,8DAAG,CAAC;EAClB,MAAM,EAAE,CAAC,OAAO,EAAE,WAAW,CAAC;EAC9B,MAAM,EAAE,KAAK;EACb,IAAI,EAAE,IAAI,+DAAI,CAAC;IACb,MAAM,EAAE,0EAAU,CAAC,CAAC,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;IACpC,IAAI,EAAE,EAAE;GACT,CAAC;CACH,CAAC,CAAC;;AAEHC,GAAG,CAAC,UAAU,CAAC;;AAEf,GAAG,CAAC,EAAE,CAAC,OAAO,EAAE,SAAS,KAAK,EAAE;EAC9B,UAAU,GAAG,KAAK,CAAC,UAAU,CAAC;EAC9B,MAAM,CAAC,OAAO,EAAE,CAAC;CAClB,CAAC,CAAC;;AAEHD,GAAK,CAAC,gBAAgB,GAAG,QAAQ,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;;AAE9D,MAAM,CAAC,EAAE,CAAC,kBAAkB,EAAE,SAAS,KAAK,EAAE;;EAE5CA,GAAK,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC;EACxB,IAAI,CAAC,KAAK,GAAG,gBAAgB,CAAC,KAAK,CAAC;EACpC,IAAI,UAAU,EAAE;IACd,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,sBAAsB,CAAC,UAAU,CAAC,CAAC;GACrD;CACF,CAAC,CAAC;;AAEH,SAAS,kBAAkB,GAAG;EAC5B,QAAQ,CAAC,cAAc,CAAC,iBAAiB,CAAC,CAAC,SAAS,GAAG,gBAAgB,CAAC,KAAK,CAAC;CAC/E;AACD,kBAAkB,EAAE,CAAC;;AAErB,gBAAgB,CAAC,gBAAgB,CAAC,OAAO,EAAE,WAAW;EACpD,kBAAkB,EAAE,CAAC;EACrB,MAAM,CAAC,OAAO,EAAE,CAAC;CAClB,CAAC,CAAC","file":"region-growing.js","sourcesContent":["import Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport {Image as ImageLayer, Tile as TileLayer} from '../src/ol/layer.js';\nimport {fromLonLat} from '../src/ol/proj.js';\nimport BingMaps from '../src/ol/source/BingMaps.js';\nimport RasterSource from '../src/ol/source/Raster.js';\n\nfunction growRegion(inputs, data) {\n  const image = inputs[0];\n  let seed = data.pixel;\n  const delta = parseInt(data.delta);\n  if (!seed) {\n    return image;\n  }\n\n  seed = seed.map(Math.round);\n  const width = image.width;\n  const height = image.height;\n  const inputData = image.data;\n  const outputData = new Uint8ClampedArray(inputData);\n  const seedIdx = (seed[1] * width + seed[0]) * 4;\n  const seedR = inputData[seedIdx];\n  const seedG = inputData[seedIdx + 1];\n  const seedB = inputData[seedIdx + 2];\n  let edge = [seed];\n  while (edge.length) {\n    const newedge = [];\n    for (let i = 0, ii = edge.length; i < ii; i++) {\n      // As noted in the Raster source constructor, this function is provided\n      // using the `lib` option. Other functions will NOT be visible unless\n      // provided using the `lib` option.\n      const next = next4Edges(edge[i]);\n      for (let j = 0, jj = next.length; j < jj; j++) {\n        const s = next[j][0];\n        const t = next[j][1];\n        if (s >= 0 && s < width && t >= 0 && t < height) {\n          const ci = (t * width + s) * 4;\n          const cr = inputData[ci];\n          const cg = inputData[ci + 1];\n          const cb = inputData[ci + 2];\n          const ca = inputData[ci + 3];\n          // if alpha is zero, carry on\n          if (ca === 0) {\n            continue;\n          }\n          if (Math.abs(seedR - cr) < delta && Math.abs(seedG - cg) < delta &&\n              Math.abs(seedB - cb) < delta) {\n            outputData[ci] = 255;\n            outputData[ci + 1] = 0;\n            outputData[ci + 2] = 0;\n            outputData[ci + 3] = 255;\n            newedge.push([s, t]);\n          }\n          // mark as visited\n          inputData[ci + 3] = 0;\n        }\n      }\n    }\n    edge = newedge;\n  }\n  return {data: outputData, width: width, height: height};\n}\n\nfunction next4Edges(edge) {\n  const x = edge[0];\n  const y = edge[1];\n  return [\n    [x + 1, y],\n    [x - 1, y],\n    [x, y + 1],\n    [x, y - 1]\n  ];\n}\n\nconst key = 'As1HiMj1PvLPlqc_gtM7AqZfBL8ZL3VrjaS3zIb22Uvb9WKhuJObROC-qUpa81U5';\n\nconst imagery = new TileLayer({\n  source: new BingMaps({key: key, imagerySet: 'Aerial'})\n});\n\nconst raster = new RasterSource({\n  sources: [imagery.getSource()],\n  operationType: 'image',\n  operation: growRegion,\n  // Functions in the `lib` object will be available to the operation run in\n  // the web worker.\n  lib: {\n    next4Edges: next4Edges\n  }\n});\n\nconst rasterImage = new ImageLayer({\n  opacity: 0.7,\n  source: raster\n});\n\nconst map = new Map({\n  layers: [imagery, rasterImage],\n  target: 'map',\n  view: new View({\n    center: fromLonLat([-119.07, 47.65]),\n    zoom: 11\n  })\n});\n\nlet coordinate;\n\nmap.on('click', function(event) {\n  coordinate = event.coordinate;\n  raster.changed();\n});\n\nconst thresholdControl = document.getElementById('threshold');\n\nraster.on('beforeoperations', function(event) {\n  // the event.data object will be passed to operations\n  const data = event.data;\n  data.delta = thresholdControl.value;\n  if (coordinate) {\n    data.pixel = map.getPixelFromCoordinate(coordinate);\n  }\n});\n\nfunction updateControlValue() {\n  document.getElementById('threshold-value').innerText = thresholdControl.value;\n}\nupdateControlValue();\n\nthresholdControl.addEventListener('input', function() {\n  updateControlValue();\n  raster.changed();\n});\n"],"sourceRoot":""}