{"version":3,"sources":["webpack:///./vector-esri-edit.js"],"names":["__webpack_require__","r","__webpack_exports__","_src_ol_Map_js__WEBPACK_IMPORTED_MODULE_0__","_src_ol_View_js__WEBPACK_IMPORTED_MODULE_1__","_src_ol_format_EsriJSON_js__WEBPACK_IMPORTED_MODULE_2__","_src_ol_interaction_js__WEBPACK_IMPORTED_MODULE_3__","_src_ol_interaction_js__WEBPACK_IMPORTED_MODULE_4__","_src_ol_interaction_js__WEBPACK_IMPORTED_MODULE_5__","_src_ol_interaction_js__WEBPACK_IMPORTED_MODULE_6__","_src_ol_layer_js__WEBPACK_IMPORTED_MODULE_7__","_src_ol_layer_js__WEBPACK_IMPORTED_MODULE_8__","_src_ol_loadingstrategy_js__WEBPACK_IMPORTED_MODULE_9__","_src_ol_proj_js__WEBPACK_IMPORTED_MODULE_10__","_src_ol_source_Vector_js__WEBPACK_IMPORTED_MODULE_11__","_src_ol_source_XYZ_js__WEBPACK_IMPORTED_MODULE_12__","_src_ol_tilegrid_js__WEBPACK_IMPORTED_MODULE_13__","serviceUrl","esrijsonFormat","vectorSource","loader","extent","resolution","projection","const","url","encodeURIComponent","$","ajax","dataType","success","response","error","alert","message","details","join","features","readFeatures","featureProjection","length","addFeatures","strategy","Object","tileSize","vector","source","raster","attributions","draw","type","select","setActive","selected","getFeatures","modify","map","interactions","extend","layers","target","document","getElementById","view","center","zoom","typeSelect","onchange","value","dirty","on","evt","element","getId","feature","fid","payload","writeFeature","getView","getProjection","post","f","done","data","result","JSON","parse","updateResults","description","code","addResults","setId","clear"],"mappings":"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","file":"vector-esri-edit.js","sourcesContent":["import Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport EsriJSON from '../src/ol/format/EsriJSON.js';\nimport {defaults as defaultInteractions, Draw, Modify, Select} from '../src/ol/interaction.js';\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\nimport {tile as tileStrategy} from '../src/ol/loadingstrategy.js';\nimport {fromLonLat} from '../src/ol/proj.js';\nimport VectorSource from '../src/ol/source/Vector.js';\nimport XYZ from '../src/ol/source/XYZ.js';\nimport {createXYZ} from '../src/ol/tilegrid.js';\n\n\nconst serviceUrl = 'https://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/' +\n    'services/PDX_Pedestrian_Districts/FeatureServer/';\nconst layer = '0';\n\nconst esrijsonFormat = new EsriJSON();\n\nconst vectorSource = new VectorSource({\n  loader: function(extent, resolution, projection) {\n    const url = serviceUrl + layer + '/query/?f=json&' +\n        'returnGeometry=true&spatialRel=esriSpatialRelIntersects&geometry=' +\n        encodeURIComponent('{\"xmin\":' + extent[0] + ',\"ymin\":' +\n            extent[1] + ',\"xmax\":' + extent[2] + ',\"ymax\":' + extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}') +\n        '&geometryType=esriGeometryEnvelope&inSR=102100&outFields=*' +\n        '&outSR=102100';\n    $.ajax({url: url, dataType: 'jsonp', success: function(response) {\n      if (response.error) {\n        alert(response.error.message + '\\n' +\n            response.error.details.join('\\n'));\n      } else {\n        // dataProjection will be read from document\n        const features = esrijsonFormat.readFeatures(response, {\n          featureProjection: projection\n        });\n        if (features.length > 0) {\n          vectorSource.addFeatures(features);\n        }\n      }\n    }});\n  },\n  strategy: tileStrategy(createXYZ({\n    tileSize: 512\n  }))\n});\n\nconst vector = new VectorLayer({\n  source: vectorSource\n});\n\nconst raster = new TileLayer({\n  source: new XYZ({\n    attributions: 'Tiles Â© <a href=\"https://services.arcgisonline.com/ArcGIS/' +\n        'rest/services/World_Topo_Map/MapServer\">ArcGIS</a>',\n    url: 'https://server.arcgisonline.com/ArcGIS/rest/services/' +\n        'World_Topo_Map/MapServer/tile/{z}/{y}/{x}'\n  })\n});\n\nconst draw = new Draw({\n  source: vectorSource,\n  type: 'Polygon'\n});\n\nconst select = new Select();\nselect.setActive(false);\nconst selected = select.getFeatures();\n\nconst modify = new Modify({\n  features: selected\n});\nmodify.setActive(false);\n\nconst map = new Map({\n  interactions: defaultInteractions().extend([draw, select, modify]),\n  layers: [raster, vector],\n  target: document.getElementById('map'),\n  view: new View({\n    center: fromLonLat([-122.619, 45.512]),\n    zoom: 12\n  })\n});\n\nconst typeSelect = document.getElementById('type');\n\n\n/**\n * Let user change the interaction type.\n */\ntypeSelect.onchange = function() {\n  draw.setActive(typeSelect.value === 'DRAW');\n  select.setActive(typeSelect.value === 'MODIFY');\n  modify.setActive(typeSelect.value === 'MODIFY');\n};\n\nconst dirty = {};\n\nselected.on('add', function(evt) {\n  const feature = evt.element;\n  feature.on('change', function(evt) {\n    dirty[evt.target.getId()] = true;\n  });\n});\n\nselected.on('remove', function(evt) {\n  const feature = evt.element;\n  const fid = feature.getId();\n  if (dirty[fid] === true) {\n    const payload = '[' + esrijsonFormat.writeFeature(feature, {\n      featureProjection: map.getView().getProjection()\n    }) + ']';\n    const url = serviceUrl + layer + '/updateFeatures';\n    $.post(url, {f: 'json', features: payload}).done(function(data) {\n      const result = JSON.parse(data);\n      if (result.updateResults && result.updateResults.length > 0) {\n        if (result.updateResults[0].success !== true) {\n          const error = result.updateResults[0].error;\n          alert(error.description + ' (' + error.code + ')');\n        } else {\n          delete dirty[fid];\n        }\n      }\n    });\n  }\n});\n\ndraw.on('drawend', function(evt) {\n  const feature = evt.feature;\n  const payload = '[' + esrijsonFormat.writeFeature(feature, {\n    featureProjection: map.getView().getProjection()\n  }) + ']';\n  const url = serviceUrl + layer + '/addFeatures';\n  $.post(url, {f: 'json', features: payload}).done(function(data) {\n    const result = JSON.parse(data);\n    if (result.addResults && result.addResults.length > 0) {\n      if (result.addResults[0].success === true) {\n        feature.setId(result.addResults[0]['objectId']);\n        vectorSource.clear();\n      } else {\n        const error = result.addResults[0].error;\n        alert(error.description + ' (' + error.code + ')');\n      }\n    }\n  });\n});\n"],"sourceRoot":""}