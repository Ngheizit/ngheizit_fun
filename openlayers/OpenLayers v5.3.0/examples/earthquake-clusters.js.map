{"version":3,"sources":["webpack:///./earthquake-clusters.js"],"names":["__webpack_require__","r","__webpack_exports__","maxFeatureCount","_src_ol_Map_js__WEBPACK_IMPORTED_MODULE_0__","_src_ol_View_js__WEBPACK_IMPORTED_MODULE_1__","_src_ol_extent_js__WEBPACK_IMPORTED_MODULE_2__","_src_ol_format_KML_js__WEBPACK_IMPORTED_MODULE_3__","_src_ol_interaction_js__WEBPACK_IMPORTED_MODULE_4__","_src_ol_interaction_js__WEBPACK_IMPORTED_MODULE_5__","_src_ol_layer_js__WEBPACK_IMPORTED_MODULE_6__","_src_ol_layer_js__WEBPACK_IMPORTED_MODULE_7__","_src_ol_source_js__WEBPACK_IMPORTED_MODULE_8__","_src_ol_source_js__WEBPACK_IMPORTED_MODULE_9__","_src_ol_source_js__WEBPACK_IMPORTED_MODULE_10__","_src_ol_style_js__WEBPACK_IMPORTED_MODULE_11__","_src_ol_style_js__WEBPACK_IMPORTED_MODULE_12__","_src_ol_style_js__WEBPACK_IMPORTED_MODULE_13__","_src_ol_style_js__WEBPACK_IMPORTED_MODULE_14__","_src_ol_style_js__WEBPACK_IMPORTED_MODULE_15__","_src_ol_style_js__WEBPACK_IMPORTED_MODULE_16__","earthquakeFill","color","earthquakeStroke","width","textFill","textStroke","invisibleFill","createEarthquakeStyle","feature","const","name","get","radius","parseFloat","substr","geometry","getGeometry","image","radius1","radius2","points","angle","Math","PI","fill","stroke","let","currentResolution","vector","source","distance","url","format","extractStyles","style","resolution","features","getSource","getFeatures","i","length","jj","originalFeatures","extent","Object","j","getExtent","max","set","calculateClusterInfo","size","min","text","toString","raster","layer","layers","interactions","extend","condition","evt","type","originalFeature","styles","push","target","view","center","zoom"],"mappings":"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","file":"earthquake-clusters.js","sourcesContent":["import Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport {createEmpty, getWidth, getHeight, extend} from '../src/ol/extent.js';\nimport KML from '../src/ol/format/KML.js';\nimport {defaults as defaultInteractions, Select} from '../src/ol/interaction.js';\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\nimport {Cluster, Stamen, Vector as VectorSource} from '../src/ol/source.js';\nimport {Circle as CircleStyle, Fill, RegularShape, Stroke, Style, Text} from '../src/ol/style.js';\n\n\nconst earthquakeFill = new Fill({\n  color: 'rgba(255, 153, 0, 0.8)'\n});\nconst earthquakeStroke = new Stroke({\n  color: 'rgba(255, 204, 0, 0.2)',\n  width: 1\n});\nconst textFill = new Fill({\n  color: '#fff'\n});\nconst textStroke = new Stroke({\n  color: 'rgba(0, 0, 0, 0.6)',\n  width: 3\n});\nconst invisibleFill = new Fill({\n  color: 'rgba(255, 255, 255, 0.01)'\n});\n\nfunction createEarthquakeStyle(feature) {\n  // 2012_Earthquakes_Mag5.kml stores the magnitude of each earthquake in a\n  // standards-violating <magnitude> tag in each Placemark.  We extract it\n  // from the Placemark's name instead.\n  const name = feature.get('name');\n  const magnitude = parseFloat(name.substr(2));\n  const radius = 5 + 20 * (magnitude - 5);\n\n  return new Style({\n    geometry: feature.getGeometry(),\n    image: new RegularShape({\n      radius1: radius,\n      radius2: 3,\n      points: 5,\n      angle: Math.PI,\n      fill: earthquakeFill,\n      stroke: earthquakeStroke\n    })\n  });\n}\n\nlet maxFeatureCount;\nlet vector = null;\nconst calculateClusterInfo = function(resolution) {\n  maxFeatureCount = 0;\n  const features = vector.getSource().getFeatures();\n  let feature, radius;\n  for (let i = features.length - 1; i >= 0; --i) {\n    feature = features[i];\n    const originalFeatures = feature.get('features');\n    const extent = createEmpty();\n    let j, jj;\n    for (j = 0, jj = originalFeatures.length; j < jj; ++j) {\n      extend(extent, originalFeatures[j].getGeometry().getExtent());\n    }\n    maxFeatureCount = Math.max(maxFeatureCount, jj);\n    radius = 0.25 * (getWidth(extent) + getHeight(extent)) /\n        resolution;\n    feature.set('radius', radius);\n  }\n};\n\nlet currentResolution;\nfunction styleFunction(feature, resolution) {\n  if (resolution != currentResolution) {\n    calculateClusterInfo(resolution);\n    currentResolution = resolution;\n  }\n  let style;\n  const size = feature.get('features').length;\n  if (size > 1) {\n    style = new Style({\n      image: new CircleStyle({\n        radius: feature.get('radius'),\n        fill: new Fill({\n          color: [255, 153, 0, Math.min(0.8, 0.4 + (size / maxFeatureCount))]\n        })\n      }),\n      text: new Text({\n        text: size.toString(),\n        fill: textFill,\n        stroke: textStroke\n      })\n    });\n  } else {\n    const originalFeature = feature.get('features')[0];\n    style = createEarthquakeStyle(originalFeature);\n  }\n  return style;\n}\n\nfunction selectStyleFunction(feature) {\n  const styles = [new Style({\n    image: new CircleStyle({\n      radius: feature.get('radius'),\n      fill: invisibleFill\n    })\n  })];\n  const originalFeatures = feature.get('features');\n  let originalFeature;\n  for (let i = originalFeatures.length - 1; i >= 0; --i) {\n    originalFeature = originalFeatures[i];\n    styles.push(createEarthquakeStyle(originalFeature));\n  }\n  return styles;\n}\n\nvector = new VectorLayer({\n  source: new Cluster({\n    distance: 40,\n    source: new VectorSource({\n      url: 'data/kml/2012_Earthquakes_Mag5.kml',\n      format: new KML({\n        extractStyles: false\n      })\n    })\n  }),\n  style: styleFunction\n});\n\nconst raster = new TileLayer({\n  source: new Stamen({\n    layer: 'toner'\n  })\n});\n\nconst map = new Map({\n  layers: [raster, vector],\n  interactions: defaultInteractions().extend([new Select({\n    condition: function(evt) {\n      return evt.type == 'pointermove' ||\n          evt.type == 'singleclick';\n    },\n    style: selectStyleFunction\n  })]),\n  target: 'map',\n  view: new View({\n    center: [0, 0],\n    zoom: 2\n  })\n});\n"],"sourceRoot":""}