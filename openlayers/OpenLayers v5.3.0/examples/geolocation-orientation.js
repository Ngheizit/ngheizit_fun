(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{271:function(e,t,n){"use strict";n.r(t);var a=n(172),o=n(3),i=n(94),r=n(2),c=n(31),s=n(6),d=n(5),g=n(12),u=new r.a({center:Object(d.f)([5.8713,45.6452]),zoom:19}),l=new o.a({layers:[new s.a({source:new g.b})],target:"map",view:u}),m=document.getElementById("geolocation_marker"),p=new i.a({positioning:"center-center",element:m,stopEvent:!1});l.addOverlay(p);var h=new c.a([],"XYZM"),v=new a.a({projection:u.getProjection(),trackingOptions:{maximumAge:1e4,enableHighAccuracy:!0,timeout:6e5}}),f=500;v.on("change",function(){var e=v.getPosition(),t=v.getAccuracy(),n=v.getHeading()||0,a=v.getSpeed()||0;!function(e,t,n,a){var o=e[0],i=e[1],r=h.getCoordinates(),c=r[r.length-1],s=c&&c[2];if(s){var d=t-(s%(2*Math.PI)+2*Math.PI)%(2*Math.PI);if(Math.abs(d)>Math.PI){var g=0<=d?1:-1;d=-g*(2*Math.PI-Math.abs(d))}t=s+d}h.appendCoordinate([o,i,t,n]),h.setCoordinates(h.getCoordinates().slice(-20)),m.src=t&&a?"data/geolocation_marker_heading.png":"data/geolocation_marker.png"}(e,n,Date.now(),a);var o=h.getCoordinates(),i=o.length;2<=i&&(f=(o[i-1][3]-o[0][3])/(i-1));var r,c=["Position: "+e[0].toFixed(2)+", "+e[1].toFixed(2),"Accuracy: "+t,"Heading: "+Math.round((r=n,360*r/(2*Math.PI)))+"&deg;","Speed: "+(3.6*a).toFixed(1)+" km/h","Delta: "+Math.round(f)+"ms"].join("<br />");document.getElementById("info").innerHTML=c}),v.on("error",function(){alert("geolocation error")});var w=0;function M(){var e=Date.now()-1.5*f;e=Math.max(e,w),w=e;var t,n,a,o,i=h.getCoordinateAtM(e,!0);i&&(u.setCenter((n=-(t=i)[2],a=u.getResolution(),o=l.getSize()[1],[t[0]-Math.sin(n)*o*a*1/4,t[1]+Math.cos(n)*o*a*1/4])),u.setRotation(-i[2]),p.setPosition(i))}var b,y=document.getElementById("geolocate");y.addEventListener("click",function(){v.setTracking(!0),l.on("postcompose",M),l.render(),E()},!1);var I=new XMLHttpRequest;I.open("GET","data/geolocation-orientation.json"),I.onload=function(){b=JSON.parse(I.responseText).data},I.send();var P=document.getElementById("simulate");function k(e){var t=e.coords;v.set("accuracy",t.accuracy),v.set("heading",t.heading*Math.PI*2/360);var n=Object(d.f)([t.longitude,t.latitude]);v.set("position",n),v.set("speed",t.speed),v.changed()}function E(){y.disabled="disabled",P.disabled="disabled"}P.addEventListener("click",function(){var a=b,e=a.shift();k(e);var o=e.timestamp;!function e(){var t=a.shift();if(t){var n=t.timestamp;k(t),window.setTimeout(function(){o=n,e()},(n-o)/.5)}}(),l.on("postcompose",M),l.render(),E()},!1)}},[[271,0]]]);
//# sourceMappingURL=geolocation-orientation.js.map